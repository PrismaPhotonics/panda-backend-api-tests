# 📋 רשימת ספסיפיקציות נדרשות לפגישה
## Panda Focus Server - הגדרת קריטריוני הצלחה/כישלון לאוטומציה

**תאריך:** 21/10/2025  
**משתתפים נדרשים:** ראש צוות פיתוח + מנהל אתר + QA Lead  
**משך פגישה משוער:** 2-3 שעות  

---

## 🎯 מטרת הפגישה

כיום בפרויקט חסרות ספסיפיקציות ברורות שמגדירות מה נחשב **עובר/לא עובר** בבדיקות האוטומציה.  
אנחנו צריכים להגדיר **ערכי סף (thresholds)** ברורים לכל סוג בדיקה.

---

## 📊 **חלק 1: ביצועים (Performance)**

### זמני תגובה API
**מה צריך להגדיר:**

| Endpoint | P95 | P99 | Timeout |
|----------|-----|-----|---------|
| `POST /config/{task_id}` | ? ms | ? ms | ? sec |
| `GET /waterfall` (Live) | ? ms | ? ms | ? sec |
| `GET /waterfall` (Historic) | ? ms | ? ms | ? sec |
| `GET /metadata/{task_id}` | ? ms | ? ms | ? sec |
| `GET /channels` | ? ms | ? ms | ? sec |
| `GET /live_metadata` | ? ms | ? ms | ? sec |

**שאלות נוספות:**
- מתחילת קונפיגורציה עד קבלת נתונים ראשונים - כמה זמן מקסימום?
- כמה זמן מותר להמתין על status 200 (no data yet) לפני timeout?
- כמה polling retries מותרים לפני שנחשב failure?

### Throughput & קיבולת
**מה צריך להגדיר:**
- כמה MB/sec data rate מקסימלי צפוי?
- כמה rows per second במצב live?
- כמה tasks בו-זמניים המערכת צריכה לתמוך?
- מהו CPU/Memory utilization מקסימלי מקובל? (למשל: CPU < 80%, Memory < 85%)

---

## 📈 **חלק 2: איכות נתונים (Data Quality)**

### Waterfall Data
**מה צריך להגדיר:**
- מהו ה-range הצפוי של amplitude? (min/max מקובלים)
- כמה אחוז missing data מותר? (למשל: < 5%)
- מהו gap מקסימלי בין rows (timestamps)?
- כמה sensors ריקים מותר בשורה אחת?

### Sensor & Frequency Ranges (ROI)
**מה צריך להגדיר:**

| פרמטר | Min | Max | ברירת מחדל |
|-------|-----|-----|-----------|
| **Sensors range** | ? | ? | ? |
| **Frequency range** | ? Hz | ? Hz | ? |
| **NFFT** | ? | ? | 1024 |
| **PRR** | ? samples/sec | ? samples/sec | ? |
| **Canvas height** | ? | ? | 1000 |

**שאלות נוספות:**
- מהו sensor range **מינימלי** חוקי? (למשל: לפחות 10 sensors)
- האם NFFT חייב להיות power of 2 או רק recommended?
- מהו Nyquist frequency enforcement - hard limit או warning?

### שינוי דינמי של ROI
**מה צריך להגדיר:**
- מהו % שינוי מקסימלי מותר ב-ROI בפעולה אחת?
  - **כרגע בקוד:** 50% (hardcoded)
  - **צריך אישור:** האם זה נכון?
- כמה שינויי ROI מותרים בדקה?
- האם יש cooldown period בין שינויים?
- מתי שינוי ROI נחשב "unsafe" ויש לחסום אותו?

---

## 🗄️ **חלק 3: MongoDB**

### Connection & Availability
**מה צריך להגדיר:**
- כמה זמן timeout לחיבור MongoDB?
- כמה retries מותרים?
- מהו recovery time מקסימלי אחרי outage?

### Data Lifecycle
**מה צריך להגדיר:**
- מתי recording נחשב "live" vs "historical"?
  - **כרגע בקוד:** 1 שעה (האם זה נכון?)
- מה הזמן המקסימלי שrecording יכול להיות "orphaned"?
- מהו retention policy לrecordings ישנים?

### Query Performance
**מה צריך להגדיר:**
- מהו query latency מקסימלי מקובל?
- כמה documents מקסימלי בתוצאה אחת?

---

## 🐰 **חלק 4: RabbitMQ**

### Message Delivery
**מה צריך להגדיר:**
- מהו timeout לשליחת command?
- כמה retries אם ההודעה נכשלת?
- מהו TTL (Time To Live) להודעות?

### Commands
**מה צריך להגדיר:**
- מהו timeout מקסימלי לביצוע `RegionOfInterestCommand`?
- מהו timeout לביצוע `PauseCommand` / `ResumeCommand`?

---

## 🚨 **חלק 5: Error Handling**

### HTTP Status Codes - מה הסמנטיקה?
**מה צריך להגדיר:**

| Status Code | משמעות | התנהגות צפויה |
|-------------|--------|---------------|
| **200** | No data yet | כמה זמן מקסימום לפני timeout? |
| **201** | Data available | האם **תמיד** חייב להיות data? |
| **208** | Already reported | האם זה success או warning? |
| **400** | Bad request | מה פורמט error messages? |
| **404** | Not found | מתי task_id נחשב "לא נמצא"? |
| **503** | Service unavailable | מהו recovery time צפוי? |

### Invalid Configurations
**מה צריך להגדיר:**
- האם API צריך **לדחות** invalid configs או **לתקן אוטומטית**?
- מה קורה עם out-of-range values? (reject או clamp to valid range?)
- מה קורה אם `start_time > end_time`?
- מה קורה אם הזמן בעתיד?
- מהו time range **מקסימלי** מותר לhistoric playback?

### Task Lifecycle
**מה צריך להגדיר:**
- האם `task_id` חייב להיות unique?
- מה קורה אם שולחים config **פעמיים** לאותו task_id?
- מהו timeout לtask לפני שהוא נמחק אוטומטית?

---

## ☁️ **חלק 6: Kubernetes & Infrastructure**

### Pod Health
**מה צריך להגדיר:**
- מהם הקריטריונים ל-**healthy pod**?
- מהו acceptable restart count?
- מהו grace period לפני שמחליפים pod?

### Service Availability
**מה צריך להגדיר:**
- מהו uptime SLA? (למשל: 99.9%)
- מהו acceptable downtime לעדכונים?

### Infrastructure Failures - התנהגות צפויה
**מה צריך להגדיר:**

| תרחיש | התנהגות צפויה |
|-------|---------------|
| **MongoDB Down** | מה הסטטוס של API? האם live data ממשיך? |
| **RabbitMQ Down** | מה קורה לcommands? האם יש queue local? |
| **Baby Analyzer Crash** | מהו recovery time? האם להתריע למשתמש? |

---

## 🧪 **חלק 7: Load Testing**

### Load Profiles
**מה צריך להגדיר:**

| Profile | Description | Concurrent Users | Duration |
|---------|-------------|------------------|----------|
| **Steady** | עומס קבוע | ? | ? |
| **Spike** | עליה פתאומית | ? → ? | ? |
| **Ramp** | עליה הדרגתית | ? → ? | ? |
| **Soak** | ריצה ממושכת | ? | 24 hours |

**שאלות נוספות:**
- מהו acceptable degradation under load?
- מהו breaking point צפוי?
- מהו acceptable memory leak? (למשל: < 1% per hour)

---

## 🔐 **חלק 8: Security**

### Authentication & Authorization
**מה צריך להגדיר:**
- האם יש authentication נדרש?
- מהם ה-roles השונים?
- מהן ההרשאות לכל endpoint?
- האם צריך rate limiting?

### Input Sanitization
**מה צריך להגדיר:**
- מהו max input size מקובל?
- אילו injection attacks צריך לבדוק?

---

## 📝 **חלק 9: SingleChannel View**

### Channel Mapping
**מה צריך להגדיר:**
- מהו channel range חוקי?
- האם `channel_id` חייב להיות בתוך sensor range?
- מה קורה אם channel לא קיים?
- מהם הערכים החוקיים של `display_sensor_id`?

---

## 📊 **חלק 10: Fiber Optics Parameters**

### Fiber Geometry
**מה צריך להגדיר:**

| Parameter | Min | Max | Unit |
|-----------|-----|-----|------|
| `fiber_length_meters` | ? | ? | meters |
| `dx` (spatial resolution) | ? | ? | meters |
| `fiber_start_meters` | ? | ? | meters |
| `number_of_channels` | ? | ? | count |

---

## 📋 **סיכום: פערים קריטיים שצריך לסגור**

### 🔴 קריטי (חייב תשובה לפני שממשיכים):
1. ✅ **זמני תגובה API** - אין שום threshold מוגדר
2. ✅ **Data quality thresholds** - לא יודעים מה נחשב "נתונים תקינים"
3. ✅ **Resource limits** - לא יודעים מתי לעשות scale
4. ✅ **ROI change limits** - יש 50% hardcoded, צריך אישור
5. ✅ **MongoDB/RabbitMQ outage behavior** - לא מוגדר מה צפוי

### 🟡 גבוה (צריך תשובה בקרוב):
- Task lifecycle rules
- Error handling semantics
- Load testing profiles
- Sensor/Frequency ranges

### 🟢 בינוני (אפשר לדחות לשלב 2):
- Security requirements
- Logging standards
- Soak testing duration

---

## 🎬 **צעדים הבאים**

### לפני הפגישה:
- [ ] שלח מסמך זה לכל המשתתפים (48 שעות לפני)
- [ ] הכן נתוני monitoring נוכחיים
- [ ] הכן דוגמאות לבעיות שהתגלו בגלל חוסר specs
- [ ] תייעד את ה-"gut feeling" thresholds שיש כרגע

### במהלך הפגישה:
- [ ] עבור על כל סעיף בשיטתיות
- [ ] תעד תשובות במסמך הזה
- [ ] זהה פריטים שדורשים מחקר נוסף
- [ ] הקצה אחראים למעקב

### אחרי הפגישה:
- [ ] עדכן את ה-automation framework עם הspecs החדשים
- [ ] צור tickets בJira לטסטים חסרים
- [ ] עדכן assertions בטסטים עם thresholds
- [ ] קבע פגישת follow-up בעוד שבועיים

---

## 📎 נספח: איפה להשתמש בתשובות?

לאחר שתקבל תשובות, צריך לעדכן:

1. **`src/utils/validators.py`** - עדכן thresholds בvalidation functions
2. **`config/settings.yaml`** - הוסף performance & resource limits
3. **`tests/conftest.py`** - הוסף fixtures עם threshold values
4. **כל קבצי הבדיקות** - עדכן assertions עם ערכי סף
5. **Jira Xray** - עדכן Expected Results בכל test case

---

**📌 הערה חשובה:**  
ללא ספסיפיקציות אלה, **כל הבדיקות האוטומטיות הן ללא משמעות** - אנחנו רק בודקים שהמערכת עובדת, אבל לא יודעים אם היא עובדת **טוב**.

---

**אחראי על המסמך:** QA Lead  
**תאריך עדכון אחרון:** 21/10/2025  
**סטטוס:** טיוטה - ממתין לפגישה



# âš ï¸ Kubernetes Connection Timeout Warning - ×”×¡×‘×¨

**×ª××¨×™×š:** 2025-11-08  
**×¡×˜×˜×•×¡:** âš ï¸ Warning (×œ× ×‘××’) - ×”×ª× ×”×’×•×ª × ×•×¨××œ×™×ª

---

## ğŸ“‹ ××” ×§×•×¨×”?

### ×”-Warning:

```
[WARNING] urllib3.connectionpool: Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) 
after connection broken by 'ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x...>, 
'Connection to 10.10.100.102 timed out. (connect timeout=None)')': /api/v1/nodes?timeoutSeconds=2
```

---

## ğŸ” ××” ×–×” ××•××¨?

### 1. ××” ×§×•×¨×”:

1. **×”××¢×¨×›×ª ×× ×¡×” ×œ×”×ª×—×‘×¨ ×œ-Kubernetes API ×™×©×™×¨×•×ª:**
   - ×›×ª×•×‘×ª: `10.10.100.102:6443` (Kubernetes API server)
   - ×–×” ×—×œ×§ ××”-sanity check ×©×× ×¡×” ×œ×‘×“×•×§ ××ª Kubernetes

2. **×”×—×™×‘×•×¨ × ×›×©×œ:**
   - ××™×Ÿ ×’×™×©×” ×™×©×™×¨×” ×œ-Kubernetes API ××”××—×©×‘ ×”××§×•××™
   - ×”-API server ×œ× × ×’×™×© ×™×©×™×¨×•×ª (×¦×¨×™×š SSH tunnel ××• VPN)

3. **urllib3 ×× ×¡×” retry:**
   - urllib3 (×¡×¤×¨×™×™×ª HTTP ×©×œ Python) ×× ×¡×” retry ××•×˜×•××˜×™×ª
   - 3 × ×™×¡×™×•× ×•×ª: `total=2`, `total=1`, `total=0`
   - ×›×œ × ×™×¡×™×•×Ÿ ×œ×•×§×— ~21 ×©× ×™×•×ª (timeout)
   - ×¡×”"×›: ~63 ×©× ×™×•×ª ×¨×§ ×¢×œ ×”-retries

4. **×”××¢×¨×›×ª ×¢×•×‘×¨×ª ×œ-SSH fallback:**
   - ××—×¨×™ ×©×”× ×™×¡×™×•× ×•×ª × ×›×©×œ×•, ×”××¢×¨×›×ª ×¢×•×‘×¨×ª ×œ-SSH fallback
   - ×–×” ×¢×•×‘×“ ×‘×”×¦×œ×—×” (×›×¤×™ ×©×¨××™× ×• ×‘×œ×•×’×™×)

---

## âœ… ×œ××” ×–×” ×§×•×¨×”?

### ×–×” ×œ× ×‘××’ - ×–×” ×”×ª× ×”×’×•×ª × ×•×¨××œ×™×ª!

**×”×¡×™×‘×”:**
- ××™×Ÿ ×’×™×©×” ×™×©×™×¨×” ×œ-Kubernetes API ××”××—×©×‘ ×”××§×•××™
- ×”-API server (`10.10.100.102:6443`) ×œ× × ×’×™×© ×™×©×™×¨×•×ª
- ×¦×¨×™×š SSH tunnel ××• VPN ×›×“×™ ×œ×’×©×ª ×™×©×™×¨×•×ª

**×”×¤×ª×¨×•×Ÿ ×”×§×™×™×:**
- ×”××¢×¨×›×ª ×¢×•×‘×¨×ª ××•×˜×•××˜×™×ª ×œ-SSH fallback
- ×–×” ×¢×•×‘×“ ×‘×”×¦×œ×—×” (×›×¤×™ ×©×¨××™× ×• ×‘×œ×•×’×™×)
- ×”×˜×¡×˜×™× ×¨×¦×™× ×‘×”×¦×œ×—×”

---

## â±ï¸ ×œ××” ×–×” ×œ×•×§×— ×›×œ ×›×š ×”×¨×‘×” ×–××Ÿ?

### Breakdown ×©×œ ×”×–××Ÿ:

| ×©×œ×‘ | ×–××Ÿ | ××” ×§×•×¨×” |
|-----|-----|---------|
| **Retry 1** | ~21 ×©× ×™×•×ª | urllib3 ×× ×¡×” ×œ×”×ª×—×‘×¨ (total=2) |
| **Retry 2** | ~21 ×©× ×™×•×ª | urllib3 ×× ×¡×” ×©×•×‘ (total=1) |
| **Retry 3** | ~21 ×©× ×™×•×ª | urllib3 ×× ×¡×” ×‘×¤×¢× ×”××—×¨×•× ×” (total=0) |
| **SSH Fallback** | ~2 ×©× ×™×•×ª | ×”××¢×¨×›×ª ×¢×•×‘×¨×ª ×œ-SSH |
| **×¡×”"×›** | **~65 ×©× ×™×•×ª** | **×›-1 ×“×§×”** |

---

## ğŸ”§ ××™×š ×œ×¤×ª×•×¨ ××ª ×–×”?

### ××¤×©×¨×•×ª 1: ×œ×”×§×˜×™×Ÿ ××ª ×”-Timeout (××•××œ×¥)

**×§×•×‘×¥:** `src/infrastructure/kubernetes_manager.py`

```python
# ×‘××§×•×:
self.k8s_core_v1.list_node(timeout_seconds=2)

# ××¤×©×¨ ×œ× ×¡×•×ª:
self.k8s_core_v1.list_node(timeout_seconds=1)  # timeout ×§×¦×¨ ×™×•×ª×¨
```

**×™×ª×¨×•× ×•×ª:**
- ×¤×—×•×ª ×–××Ÿ ×¢×œ retries
- ×¢×“×™×™×Ÿ ×¢×•×‘×“ ×¢× SSH fallback

---

### ××¤×©×¨×•×ª 2: ×œ×“×œ×’ ×¢×œ Direct API Access (×× ××™×Ÿ ×’×™×©×”)

**×§×•×‘×¥:** `src/infrastructure/kubernetes_manager.py`

```python
def _load_k8s_config(self):
    """Load Kubernetes configuration."""
    # Check if direct access is available (quick check)
    if not self._can_access_k8s_api_directly():
        # Skip direct API access, go straight to SSH fallback
        self.logger.info("Direct Kubernetes API access not available, using SSH fallback")
        self._init_ssh_fallback()
        return
    
    # Try direct API access...
```

**×™×ª×¨×•× ×•×ª:**
- ×—×•×¡×š ××ª ×›×œ ×”×–××Ÿ ×¢×œ retries
- ×¢×•×‘×¨ ×™×©×¨ ×œ-SSH fallback

---

### ××¤×©×¨×•×ª 3: ×œ×”×’×“×™×¨ SSH Fallback ×›×‘×¨×™×¨×ª ××—×“×œ (×× ××™×Ÿ ×’×™×©×” ×™×©×™×¨×”)

**×§×•×‘×¥:** `config/environments.yaml`

```yaml
kubernetes:
  use_ssh_fallback: true  # Skip direct API access, use SSH fallback
```

**×™×ª×¨×•× ×•×ª:**
- ×—×•×¡×š ××ª ×›×œ ×”×–××Ÿ ×¢×œ retries
- ×¢×•×‘×“ ××”×¨ ×™×•×ª×¨

---

## ğŸ“Š ×¡×™×›×•×

### ××” ×§×•×¨×” ×¢×›×©×™×•:

1. âœ… **×”××¢×¨×›×ª ×× ×¡×” ×œ×”×ª×—×‘×¨ ×™×©×™×¨×•×ª** - × ×›×©×œ (timeout)
2. âš ï¸ **urllib3 ×× ×¡×” retry 3 ×¤×¢××™×** - ×›×œ retry ×œ×•×§×— ~21 ×©× ×™×•×ª
3. âœ… **×”××¢×¨×›×ª ×¢×•×‘×¨×ª ×œ-SSH fallback** - ×¢×•×‘×“ ×‘×”×¦×œ×—×”
4. âœ… **×”×˜×¡×˜×™× ×¨×¦×™× ×‘×”×¦×œ×—×”** - ×”×›×œ ×‘×¡×“×¨

### ××” ××¤×©×¨ ×œ×©×¤×¨:

1. **×œ×”×§×˜×™×Ÿ ××ª ×”-timeout** - ×¤×—×•×ª ×–××Ÿ ×¢×œ retries
2. **×œ×“×œ×’ ×¢×œ direct API access** - ×× ××™×Ÿ ×’×™×©×” ×™×©×™×¨×”
3. **×œ×”×’×“×™×¨ SSH fallback ×›×‘×¨×™×¨×ª ××—×“×œ** - ×× ××™×Ÿ ×’×™×©×” ×™×©×™×¨×”

---

## âœ… ×”××œ×¦×•×ª

### ×œ×˜×•×•×— ×”×§×¦×¨ (×¢×›×©×™×•):

1. **×–×” ×œ× ×‘××’** - ×–×” warning × ×•×¨××œ×™
2. **×”×˜×¡×˜×™× ×¨×¦×™× ×‘×”×¦×œ×—×”** - ×”×›×œ ×¢×•×‘×“ ×‘×¡×•×£
3. **×–×” ×œ×•×§×— ×–××Ÿ** - ××‘×œ ×–×” ×œ× ××¤×¨×™×¢ ×œ×˜×¡×˜×™×

### ×œ×˜×•×•×— ×”××¨×•×š (×©×™×¤×•×¨):

1. **×œ×”×§×˜×™×Ÿ ××ª ×”-timeout** - ×¤×—×•×ª ×–××Ÿ ×¢×œ retries
2. **×œ×“×œ×’ ×¢×œ direct API access** - ×× ××™×Ÿ ×’×™×©×” ×™×©×™×¨×”
3. **×œ×”×’×“×™×¨ SSH fallback ×›×‘×¨×™×¨×ª ××—×“×œ** - ×× ××™×Ÿ ×’×™×©×” ×™×©×™×¨×”

---

## ğŸ” ××™×š ×œ×‘×“×•×§ ×× ×™×© ×’×™×©×” ×™×©×™×¨×”?

```bash
# × ×¡×” ×œ×”×ª×—×‘×¨ ×œ-Kubernetes API ×™×©×™×¨×•×ª
curl -k https://10.10.100.102:6443/api/v1/nodes

# ×× ×–×” ×¢×•×‘×“ - ×™×© ×’×™×©×” ×™×©×™×¨×”
# ×× ×–×” × ×›×©×œ - ××™×Ÿ ×’×™×©×” ×™×©×™×¨×” (×¦×¨×™×š SSH tunnel)
```

---

**×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”:** 2025-11-08  
**×¡×˜×˜×•×¡:** âš ï¸ Warning (×œ× ×‘××’) - ×”×ª× ×”×’×•×ª × ×•×¨××œ×™×ª


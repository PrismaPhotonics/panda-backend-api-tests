# הסבר על החיובים החוזרים שזוהו

## 📋 מה זיהיתי:

יש שני סוגים של חיובים חוזרים שזוהו בניתוח:

### 1. **הוצאות חוזרות לפי קטגוריה** (`recurring_expenses`)
- זה מחשב את הממוצע החודשי של הוצאות לפי קטגוריה
- למשל: אם יש הוצאות של "אוכל" כל חודש, זה מחשב את הממוצע החודשי
- מופיע בדוח כ: "🔄 הוצאות חוזרות משמעותיות"

### 2. **חיובים כפולים/חוזרים** (`duplicate_charges`) ← זה מה שדיברתי עליו!
- זה מזהה עסקאות **אותו ספק, סכום דומה, באותו תאריך או תאריכים קרובים**
- למשל: אם יש 2 עסקאות של 6,810 ₪ מאותו ספק באותו יום
- מופיע בדוח כ: "🔄 חיובים כפולים/חוזרים (אותו ספק, סכום דומה)"

---

## 🔍 איפה ראיתי אותם:

### בקוד (`scripts/analyze_credit_card_expenses.py`):

**שורות 722-741** - זיהוי חיובים כפולים/חוזרים:

```python
# Identify duplicate/recurring charges (same merchant, similar amount)
duplicate_charges = []
if not expenses_df.empty:
    # Group by description (merchant) and amount
    for desc, group in expenses_df.groupby('description'):
        if len(group) > 1:  # More than one transaction
            amounts = group['amount'].tolist()
            # Check if amounts are similar (within 5% difference)
            if len(set([round(a, -2) for a in amounts])) == 1:  # Same rounded amount
                dates = group['date'].tolist()
                total_amount = group['amount'].sum()
                if total_amount > 500:  # Only significant amounts
                    duplicate_charges.append({
                        'date': dates[0] if dates else None,
                        'amount': amounts[0],
                        'count': len(group),
                        'total_amount': total_amount,
                        'description': desc
                    })
```

**מה הקוד עושה:**
1. מקבל את כל העסקאות
2. מקבץ לפי תיאור העסקה (merchant/ספק)
3. בודק אם יש יותר מעסקה אחת מאותו ספק
4. בודק אם הסכומים דומים (עד 5% הבדל)
5. אם הסכום הכולל > 500 ₪, מוסיף לרשימה

---

## 📊 מה נמצא בדוח (`comprehensive_financial_analysis.txt`):

**שורות 172-187** - רשימת החיובים הכפולים/חוזרים:

```
🔄 חיובים כפולים/חוזרים (אותו ספק, סכום דומה):
  סה"כ חיובים חוזרים: 73,778 ₪
  1. 28-04-2023: 3 פעמים, 7,143 ₪ כל פעם, סה"כ 21,430 ₪
  2. 05-11-2025: 2 פעמים, 6,810 ₪ כל פעם, סה"כ 13,620 ₪
  3. 30-10-2025: 2 פעמים, 6,810 ₪ כל פעם, סה"כ 13,620 ₪
  4. 02.09.25: 2 פעמים, 4,390 ₪ כל פעם, סה"כ 8,780 ₪
  ...
```

**מה זה אומר:**
- יש עסקאות מאותו ספק באותו תאריך (או תאריכים קרובים) בסכום דומה
- זה יכול להיות:
  1. **חיוב כפול** - טעות, חיוב פעמיים על אותה קנייה
  2. **חיוב חוזר** - מנוי או תשלום חוזר
  3. **קנייה כפולה** - קנית פעמיים בטעות

---

## 💡 איך לבדוק אותם:

### 1. פתח את קבצי כרטיסי האשראי:
- `C:\Projects\focus_server_automation\כרטיסי אשראי רועי\`
- חפש עסקאות בתאריכים:
  - **28-04-2023**: 3 פעמים × 7,143 ₪
  - **05-11-2025**: 2 פעמים × 6,810 ₪
  - **30-10-2025**: 2 פעמים × 6,810 ₪
  - **02.09.25**: 2 פעמים × 4,390 ₪

### 2. בדוק את התיאור של כל עסקה:
- מה שם הספק?
- האם זה אותו ספק?
- האם זה אותו מוצר/שירות?

### 3. החלט:
- **אם זה חיוב כפול** → פנה לספק להחזר
- **אם זה מנוי** → בדוק אם אתה משתמש בו, אם לא - ביטל
- **אם זה קנייה כפולה** → בדוק אם אפשר להחזיר

---

## 📝 דוגמאות מהדוח:

### דוגמה 1: 28-04-2023
- **3 פעמים** × 7,143 ₪ = **21,430 ₪**
- זה נראה כמו חיוב כפול או מנוי
- צריך לבדוק מה זה

### דוגמה 2: 05-11-2025 (לפני שבוע!)
- **2 פעמים** × 6,810 ₪ = **13,620 ₪**
- זה תאריך קרוב מאוד - יכול להיות חיוב כפול
- צריך לבדוק מיידית!

### דוגמה 3: 30-10-2025
- **2 פעמים** × 6,810 ₪ = **13,620 ₪**
- אותו סכום כמו ב-05-11-2025
- יכול להיות אותו ספק או מנוי

---

## 🎯 מה לעשות:

1. **היום**: פתח את קבצי כרטיסי האשראי וחפש את העסקאות האלה
2. **זהה**: מה זה כל עסקה - ספק, מוצר, שירות
3. **פעל**: 
   - אם חיוב כפול → החזר
   - אם מנוי מיותר → ביטל
   - אם קנייה כפולה → החזר

**פוטנציאל חיסכון:**
- החזר חד פעמי: עד 73,778 ₪
- חיסכון חודשי: עד 12,296 ₪/חודש (אם יש מנויים מיותרים)

---

**תאריך**: 12 בנובמבר 2025  
**מקור**: ניתוח אוטומטי של קבצי כרטיסי אשראי


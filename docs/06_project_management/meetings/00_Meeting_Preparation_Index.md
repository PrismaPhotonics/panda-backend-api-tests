# הכנה מקיפה לפגישת סקירת טסטים - PZ-13756
## מסמך אינדקס ראשי למפגש עם הצוות

---

## 📌 תקציר מנהלים (Executive Summary)

מסמך זה מהווה **תיק הכנה מלא לפגישה** על 5 טסטי ביצועים ותשתית קריטיים עבור Focus Server.  
כל טסט מנותח **לפרטי פרטים**, כולל:
- **מטרה אסטרטגית** - מדוע הטסט קיים ומה הערך העסקי שלו
- **מה בודקים בדיוק** - הסצנריוים והזרימות המדויקות
- **נחיצות הטסט** - למה אי אפשר בלעדיו
- **מימוש מעשי בקוד** - איך זה ממומש בפייתון עם הסבר לכל שורה
- **שאלות לפגישה** - רשימה מלאה של שאלות להעלות

---

## 📂 מבנה המסמכים

המסמכים מחולקים לפי טסט, כדי להקל על ניווט וקריאה:

### 🎯 טסטים בעדיפות גבוהה (High Priority)

| מס' | Jira ID | שם הטסט | קובץ מפורט | זמן קריאה |
|-----|---------|---------|-----------|-----------|
| 1   | PZ-13905 | Performance - High Throughput Stress Test | [01_High_Throughput_Test.md](01_High_Throughput_Test.md) | ~15 דק' |
| 2   | PZ-13896 | Performance – Concurrent Task Limit | [02_Concurrent_Task_Limit.md](02_Concurrent_Task_Limit.md) | ~15 דק' |
| 3   | PZ-13770 | Performance – /config Latency P95/P99 | [03_Config_Latency_P95.md](03_Config_Latency_P95.md) | ~12 דק' |

### 🔧 טסטי תשתית (Infrastructure Tests)

| מס' | Jira ID | שם הטסט | קובץ מפורט | זמן קריאה |
|-----|---------|---------|-----------|-----------|
| 4   | PZ-13687 | MongoDB Recovery – Recordings Indexed After Outage | [04_MongoDB_Recovery.md](04_MongoDB_Recovery.md) | ~10 דק' |

### 📊 טסטי ביצועים נוספים (Additional Performance)

| מס' | Jira ID | שם הטסט | קובץ מפורט | זמן קריאה |
|-----|---------|---------|-----------|-----------|
| 5   | PZ-13571 | Performance – /configure latency p95 | [05_Configure_Latency_P95.md](05_Configure_Latency_P95.md) | ~10 דק' |

---

## 🚀 סדר קריאה מומלץ לפגישה

### אם יש לך **60 דקות** לפני הפגישה:
1. קרא את **המסמך הזה** (5 דק')
2. קרא את **03_Config_Latency_P95.md** (הכי קל להתחיל) (12 דק')
3. קרא את **01_High_Throughput_Test.md** (הכי מורכב) (15 דק')
4. קרא את **02_Concurrent_Task_Limit.md** (15 דק')
5. עיין ב-**04_MongoDB_Recovery.md** (10 דק')
6. עיין ב-**05_Configure_Latency_P95.md** (אם נשאר זמן) (8 דק')

### אם יש לך **30 דקות** בלבד:
1. קרא את **03_Config_Latency_P95.md** במלואו
2. קרא את **סיכום מהיר** בכל אחד מהמסמכים האחרים
3. עיין ב-**שאלות לפגישה** בסוף כל מסמך

### אם יש לך **15 דקות** בלבד:
1. קרא את החלקים **"תקציר מהיר לפגישה"** בכל מסמך
2. עיין ב-**טבלאות השוואה** למטה במסמך הזה

---

## 📊 טבלת השוואה מהירה - כל הטסטים

| הטסט | מה בודקים | סיכון אם לא בודקים | מורכבות מימוש | סטטוס |
|------|-----------|---------------------|----------------|--------|
| **PZ-13905<br/>High Throughput** | המערכת מתמודדת או דוחה קונפיגורציות עם תפוקה גבוהה מאוד (>50 Mbps) | קריסת מערכת בייצור בגלל עומס יתר | 🟡 בינונית | ✅ Automated |
| **PZ-13896<br/>Concurrent Tasks** | כמה tasks במקביל המערכת יכולה לטפל (10, 20, 30, 40, 50) | חסימה או קריסה כשמשתמשים רבים פועלים במקביל | 🟠 גבוהה | ✅ Automated |
| **PZ-13770<br/>/config Latency P95** | 95% מהבקשות ל-POST /config עונות תוך < 300ms | חוויית משתמש גרועה, timeouts | 🟢 נמוכה | ✅ Automated |
| **PZ-13687<br/>MongoDB Recovery** | אחרי הפסקת MongoDB, recordings חדשים נוספים אוטומטית | איבוד נתונים, חוסר סנכרון | 🔴 מאוד גבוהה | ⚠️ Partial |
| **PZ-13571<br/>/configure Latency** | בקשות ל-POST /configure עונות מהר (p95 < 2s) | חוויית משתמש איטית | 🟢 נמוכה | ✅ Automated |

---

## 🎓 מושגי יסוד שצריך להכיר

לפני שנכנסים לפרטים, כדאי להבין מספר מושגים מפתח:

### 1️⃣ **Throughput (תפוקת נתונים)**
**מה זה**: כמות הנתונים שהמערכת מעבדת ליחידת זמן.  
**יחידות**: Mbps (Megabits per second)  
**דוגמה**: אם המערכת מעבדת 500 sensors × 2048 frequency bins × 4 bytes × 2 rows/sec = **16 Mbps**

**נוסחת חישוב**:
```
Throughput (Mbps) = (Sensors × Frequency Bins × 4 bytes × Rows/sec × 8 bits) / 1,000,000
```

**למה זה חשוב**: Throughput גבוה מדי יגרום לחנק ברשת, עומס CPU ואפילו קריסה.

---

### 2️⃣ **NFFT (FFT Size)**
**מה זה**: Number of Fast Fourier Transform points - גודל חלון הזמן לחישוב ספקטרוגרמה.  
**ערכים תקפים**: 128, 256, 512, 1024, 2048, 4096 (חזקות של 2)

**Trade-off**:
| NFFT | Frequency Resolution | Time Resolution | CPU Load | Rows/sec |
|------|---------------------|----------------|----------|----------|
| 128  | נמוכה (פחות דיוק בתדר) | גבוהה (עדכונים מהירים) | נמוך | גבוה מאוד |
| 1024 | בינונית | בינונית | בינוני | בינוני |
| 4096 | גבוהה מאוד (דיוק מקסימלי) | נמוכה (עדכונים איטיים) | גבוה מאוד | נמוך מאוד |

**למה זה חשוב**: NFFT קטן (256) → הרבה rows/sec → throughput גבוה!

---

### 3️⃣ **P95 / P99 Latency (Percentiles)**
**מה זה**: מדד שמראה כמה זמן לוקח ל-95% או 99% מהבקשות להתבצע.

**דוגמה**:
- אם יש 100 בקשות עם latencies: 50ms, 55ms, 60ms, ..., 200ms, 500ms, 800ms
- **P95** = הבקשה ה-95 הכי מהירה (לדוגמה: 200ms)
- **P99** = הבקשה ה-99 הכי מהירה (לדוגמה: 500ms)

**למה לא ממוצע?**  
ממוצע מסתיר outliers. אם 99 בקשות לוקחות 50ms ובקשה אחת לוקחת 10 שניות, הממוצע יהיה 150ms - לא משקף את המציאות!

**למה זה חשוב**: SLA (Service Level Agreement) בתעשייה מבוסס על P95/P99, לא ממוצע.

---

### 4️⃣ **Nyquist Frequency**
**מה זה**: התדר המקסימלי שניתן לבדוק בלי לגרום לעיוות נתונים (aliasing).

**נוסחה**:
```
Nyquist Frequency = PRR / 2
```

**דוגמה**:
- אם PRR = 2000 samples/sec
- Nyquist = 1000 Hz
- אם תבקש לבדוק תדרים עד 1500 Hz → המערכת **חייבת** לדחות!

**למה זה חשוב**: זה לא באג - זה **פיזיקה**. אם חורגים מ-Nyquist → הנתונים מעוותים ולא ניתנים לשימוש.

---

### 5️⃣ **Concurrent Tasks (משימות מקבילות)**
**מה זה**: כמה tasks (jobs) יכולים לרוץ בו-זמנית במערכת.

**דוגמה**:
- משתמש A יוצר task עם 100 sensors
- משתמש B יוצר task עם 200 sensors (במקביל)
- משתמש C יוצר task עם 50 sensors (במקביל)
- **סה"כ**: 3 concurrent tasks

**למה זה חשוב**: אם המערכת לא יכולה לטפל במקביל → המשתמשים יקבלו errors, timeouts או המערכת תקרוס.

---

## 🎯 שאלות כלליות להעלות בפגישה

### 📋 שאלות מדיניות ואסטרטגיה

1. **מה ה-SLA הרשמי של Focus Server?**
   - איזה P95/P99 latency נחשבים מקובלים?
   - מה success rate מינימלי (95%? 99%? 99.9%)?

2. **מהן תרחישי השימוש הצפויים בייצור?**
   - כמה משתמשים במקביל?
   - מהו הגודל הממוצע של קונפיגורציה?
   - מהו תרחיש ה-worst-case?

3. **מה הפעולות כאשר טסט נכשל?**
   - האם יש rollback אוטומטי?
   - האם יש alerts ל-DevOps?
   - האם יש dashboards לניטור?

4. **מה ההחלטה לגבי High Throughput (PZ-13905)?**
   - Option A: לקבל עם warning
   - Option B: לדחות
   - Option C: לאשר רק ל-admins

5. **מהן הגבולות המקסימליים?**
   - כמה concurrent tasks מותר בייצור?
   - מה throughput מקסימלי מותר (50 Mbps? 100 Mbps)?

---

### 🔧 שאלות טכניות

6. **מהן ה-resources של הסביבה?**
   - כמה CPU cores ל-Focus Server?
   - כמה RAM?
   - מהי רוחב הפס של הרשת?

7. **האם יש resource limits ב-Kubernetes?**
   - CPU limits?
   - Memory limits?
   - Connection pool limits?

8. **איך מתבצעת ניהול תורים (queueing)?**
   - האם יש תור ל-tasks?
   - מה קורה כשהתור מלא?
   - מה timeout ל-tasks?

9. **מהי מדיניות ה-retry?**
   - כמה retries ל-MongoDB failures?
   - מהו exponential backoff?

10. **איך נבדקים הטסטים ב-CI/CD?**
    - האם הם רצים בכל commit?
    - באיזו תדירות?
    - מה קורה כשטסט נכשל?

---

## 📈 תוצאות ציפיות מהפגישה

בסוף הפגישה, אתה צריך לצאת עם:

### ✅ החלטות ברורות:
1. **Thresholds מוגדרים**:
   - P95/P99 latency targets
   - Max concurrent tasks
   - Max throughput limit
   - Success rate minimum

2. **מדיניות התנהגות**:
   - מה קורה כשטסט נכשל?
   - מה קורה כשחורגים מ-threshold?
   - מה קורה במצב MongoDB outage?

3. **תוכנית לטווח קצר**:
   - אילו טסטים דורשים שיפור?
   - אילו פיצ'רים חסרים?
   - מה לוח הזמנים?

4. **תיעוד**:
   - מי אחראי על עדכון הדוקומנטציה?
   - איפה מתועדים ה-SLAs?
   - איך משתפים עם הצוות?

---

## 🗂️ חומרי עזר נוספים

### קבצים רלוונטיים בפרויקט:
- **קוד הטסטים**: `tests/integration/performance/test_performance_high_priority.py`
- **קוד MongoDB Recovery**: `tests/performance/test_mongodb_outage_resilience.py`
- **Configuration Models**: `src/models/focus_server_models.py`
- **API Client**: `src/api/focus_server_api.py`

### מקורות חיצוניים:
- **Pytest Documentation**: https://docs.pytest.org/
- **Performance Testing Best Practices**: https://martinfowler.com/articles/practical-test-pyramid.html
- **SLA Metrics**: https://sre.google/sre-book/service-level-objectives/

---

## 📝 הערות סופיות

1. **המסמכים המפורטים מכילים הסברים מעמיקים על כל טסט**.  
   אל תדלג על הקריאה - הם נכתבו במיוחד כדי שתהיה מוכן לחלוטין.

2. **השאלות בסוף כל מסמך הן קריטיות**.  
   תכין אותן מראש - זה יראה שאתה מוכן ומבין את המערכת לעומק.

3. **הקוד המפורט מראה בדיוק איך הטסטים עובדים**.  
   אם מישהו בפגישה שואל "איך זה ממומש?" - אתה יודע את התשובה.

4. **זכור: הטסטים האלה הם לא "nice to have" - הם קריטיים**.  
   בלעדיהם, המערכת יכולה לקרוס בייצור, לאבד נתונים, או לגרום לחוויית משתמש גרועה.

---

## ✨ בהצלחה בפגישה!

**אתה מוכן. אתה יודע את החומר לעומק. תצליח!** 🚀

---

*מסמך זה הוכן עבור: Roy Avrahami*  
*תאריך: אוקטובר 2025*  
*פרויקט: Focus Server Automation (PZ-13756)*


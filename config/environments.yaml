# Focus Server Automation Framework - Environment Configuration
# =============================================================
# 
# Environments: staging, kefar_saba
# Default: staging (November 2025)
# 
# Staging environment uses 10.10.10.100 (new IP addresses)
# Kefar_Saba environment uses 10.10.100.100 (production IP addresses)

environments:
  # ============================================================================
  # STAGING ENVIRONMENT (November 2025)
  # ============================================================================
  staging:
    name: "Staging Environment"
    description: "Staging environment for testing with updated IP addresses (10.10.10.100)"
    
    # Focus Server (Staging)
    focus_server:
      base_url: "https://10.10.10.100/focus-server/"  # Backend URL
      frontend_url: "https://10.10.10.100/liveView"    # Frontend URL
      frontend_api_url: "https://10.10.10.100/prisma/api/internal/sites/prisma-210-1000"  # Frontend API URL
      site_id: "prisma-210-1000"
      ssl: true
      verify_ssl: false  # Self-signed cert
      
      # Port forwarding (if needed for local access)
      port_forward:
        enabled: false
        service: "focus-server-service"
        namespace: "default"
        local_port: 5000
        remote_port: 5000
    
    # gRPC Configuration (From usersettings.json)
    grpc:
      timeout_seconds: 500              # GrpcTimeout
      stream_min_timeout_seconds: 600   # GrpcStreamMinTimeout_sec
      num_retries: 10                   # NumGrpcRetries
      retry_backoff_factor: 2.0         # Exponential backoff
    
    # System Constraints (From usersettings.json)
    constraints:
      frequency:
        max_hz: 1000                    # FrequencyMax
        min_hz: 0                       # FrequencyMin
        min_range_hz: 1                 # FrequencyMinRange
      sensors:
        total_range: 2222               # SensorsRange (0-2222)
        default_start: 11               # StartChannel
        default_end: 109                # EndChannel
      windows:
        max_concurrent: 30              # MaxWindows
        num_live_screens: 30            # NumLiveScreens
        num_tabs: 10                    # NumTabs
    
    # NFFT Configuration (From usersettings.json)
    nfft:
      default: 1024                     # Default Nfft
      valid_values:                     # nfftSingleChannel options
        - 128
        - 256
        - 512
        - 1024
        - 2048
        - 4096
        - 8192
        - 16384
        - 32768
        - 65536
    
    # Display Defaults (From usersettings.json)
    defaults:
      frequency:
        start_hz: 0                     # StartFrequency_hz
        end_hz: 1000                    # EndFrequency_hz
      waterfall:
        num_lines: 200                  # NumLinesToDisplay
      time:
        window_seconds: 30              # TimeWindow "30s"
        display_axis_duration: 30       # DisplayTimeAxisDuration
      view_type: "MultiChannelSpectrogram"  # ViewType
      refresh_rate_hz: 20               # RefreshRate
    
    # Features (From usersettings.json)
    features:
      enable_reconnection: true         # EnableReconnection
      enable_debug_tools: false         # EnableDebugTools
      split_screen: true                # SplitScreen
      full_screen: false                # FullScreen
    
    # Saved Data (From usersettings.json)
    saved_data:
      folder: "C:\\Panda\\SavedData"    # SavedData.Folder
      enable_save: true                 # EnableSave
      enable_load: true                 # EnableLoad
    
    # MongoDB (Staging Environment - Different IP from kefar_saba)
    mongodb:
      host: "10.10.10.108"                # Staging LoadBalancer IP
      port: 27017
      username: "prisma"
      password: "prisma"
      database: "prisma"
      auth_source: "prisma"
      connection_string: "mongodb://prisma:prisma@10.10.10.108:27017/?authSource=prisma"
      ssl: false
      replica_set: null
    
    # RabbitMQ (Staging Environment - Different IP from kefar_saba)
    rabbitmq:
      host: "10.10.10.107"               # Staging LoadBalancer IP
      port: 5672                         # AMQP
      ssl_port: 5671                     # AMQP SSL
      management_port: 15672             # Management UI
      prometheus_port: 9419              # Prometheus metrics
      erlang_port: 4369                  # Erlang Port Mapper
      inter_node_port: 25672             # Inter-node communication
      username: "prisma"
      password: "prismapanda"
      vhost: "/"
      ssl: false
      exchange: "prisma"
    
    # Kubernetes
    kubernetes:
      api_server: "https://10.10.100.102:6443"
      dashboard: "https://10.10.100.102/"
      context: "panda-cluster"
      namespace: "panda"
      config_file: "~/.kube/config-panda"
      
      access_method: "ssh_tunnel"
      ssh_gateway:
        jump_host: "10.10.10.10"
        target_host: "10.10.10.150"
        jump_user: "root"
        jump_password: "PASSW0RD"
        target_user: "prisma"
        target_password: "PASSW0RD"
      
      k9s:
        available: true
        command: "k9s"
        default_namespace: "panda"
        
      services:
        focus_server:
          name: "panda-panda-focus-server"
          type: "ClusterIP"
          cluster_ip: "10.43.103.101"
          internal_endpoint: "panda-panda-focus-server.panda:5000"
          pod_selector: "app.kubernetes.io/name=panda-panda-focus-server"
        mongodb:
          name: "mongodb"
          type: "LoadBalancer"
          cluster_ip: "10.43.74.248"
          internal_endpoint: "mongodb.panda:27017"
          external_ip: "10.10.10.108:27017"  # Staging LoadBalancer IP
          pod_selector: "app.kubernetes.io/instance=mongodb"
        rabbitmq:
          name: "rabbitmq-panda"
          type: "LoadBalancer"
          cluster_ip: "10.43.10.166"
          internal_endpoint: "rabbitmq-panda.panda:5672"
          external_ip: "10.10.10.107"    # Staging LoadBalancer IP
          pod_selector: "app.kubernetes.io/instance=rabbitmq-panda"
        grpc_service:
          name: "grpc-service-*"
          type: "NodePort"
          cluster_ip: "Dynamic (varies per service)"
          internal_endpoint: "grpc-service-*.panda:12301+"
          pod_selector: "app=grpc-service"
          note: "gRPC port starts from 12301 and increments for each service instance"
    
    # SSH Access (Staging Environment)
    ssh:
      jump_host:
        host: "10.10.10.10"
        port: 22
        username: "root"
        password: "PASSW0RD"
        description: "panda-staging-host - Proxmox staging host"
      target_host:
        host: "10.10.10.150"
        port: 22
        username: "prisma"
        password: "PASSW0RD"
        key_file: "~/.ssh/panda_staging_key"
        description: "worker-node - K8s worker with kubectl/k9s access"
      connect_command: |
        ssh root@10.10.10.10
        # Then from panda-staging-host:
        ssh prisma@10.10.10.150
        # Then run: k9s
    
    # Test Data
    test_data:
      base_path: "/tmp/focus_staging_test_data"
      cleanup_after_test: true
    
    # Infrastructure Services
    services:
      focus_server:
        deployment: "panda-panda-focus-server"
        service: "panda-panda-focus-server"
        pod_selector: "app.kubernetes.io/name=panda-panda-focus-server"
      mongodb:
        deployment: "mongodb"
        service: "mongodb"
        pod_selector: "app.kubernetes.io/instance=mongodb"
      rabbitmq:
        deployment: "rabbitmq-panda"
        service: "rabbitmq-panda"
        pod_selector: "app.kubernetes.io/instance=rabbitmq-panda"
    
    # Logging Configuration (From usersettings.json)
    logging:
      log_grpc_messages: false
      log_grpc_validation: false
      log_paging: false
      log_working_queue: false

  # ============================================================================
  # KEFAR_SABA ENVIRONMENT (IP: 10.10.100.100)
  # ============================================================================
  kefar_saba:
    name: "Kefar Saba"
    description: "Kefar Saba environment with IP address 10.10.100.100"
    
    # Focus Server (Kefar Saba)
    focus_server:
      base_url: "https://10.10.100.100/focus-server/"  # Backend URL
      frontend_url: "https://10.10.100.100/liveView"    # Frontend URL
      frontend_api_url: "https://10.10.100.100/prisma/api/internal/sites/prisma-210-1000"  # API URL
      site_id: "prisma-210-1000"
      ssl: true
      verify_ssl: false  # Self-signed cert
      
      port_forward:
        enabled: false
        service: "focus-server-service"
        namespace: "default"
        local_port: 5000
        remote_port: 5000
    
    # gRPC Configuration
    grpc:
      timeout_seconds: 500
      stream_min_timeout_seconds: 600
      num_retries: 10
      retry_backoff_factor: 2.0
    
    # System Constraints
    constraints:
      frequency:
        max_hz: 1000
        min_hz: 0
        min_range_hz: 1
      sensors:
        total_range: 2222
        default_start: 11
        default_end: 109
      windows:
        max_concurrent: 30
        num_live_screens: 30
        num_tabs: 10
    
    # NFFT Configuration
    nfft:
      default: 1024
      valid_values:
        - 128
        - 256
        - 512
        - 1024
        - 2048
        - 4096
        - 8192
        - 16384
        - 32768
        - 65536
    
    # Display Defaults
    defaults:
      frequency:
        start_hz: 0
        end_hz: 1000
      waterfall:
        num_lines: 200
      time:
        window_seconds: 30
        display_axis_duration: 30
      view_type: "MultiChannelSpectrogram"
      refresh_rate_hz: 20
    
    # Features
    features:
      enable_reconnection: true
      enable_debug_tools: false
      split_screen: true
      full_screen: false
    
    # Saved Data
    saved_data:
      folder: "C:\\Panda\\SavedData"
      enable_save: true
      enable_load: true
    
    # MongoDB (Kefar Saba LoadBalancer)
    mongodb:
      host: "10.10.100.108"
      port: 27017
      username: "prisma"
      password: "prisma"
      database: "prisma"
      auth_source: "prisma"
      connection_string: "mongodb://prisma:prisma@10.10.100.108:27017/?authSource=prisma"
      ssl: false
      replica_set: null
    
    # RabbitMQ (Kefar Saba LoadBalancer)
    rabbitmq:
      host: "10.10.100.107"
      port: 5672
      ssl_port: 5671
      management_port: 15672
      prometheus_port: 9419
      erlang_port: 4369
      inter_node_port: 25672
      username: "prisma"
      password: "prismapanda"
      vhost: "/"
      ssl: false
      exchange: "prisma"
    
    # Kubernetes (Kefar Saba Cluster)
    kubernetes:
      api_server: "https://10.10.100.102:6443"
      dashboard: "https://10.10.100.102/"
      context: "panda-cluster"
      namespace: "panda"
      config_file: "~/.kube/config-panda"
      
      access_method: "ssh_tunnel"
      ssh_gateway:
        jump_host: "10.10.100.3"
        target_host: "10.10.100.113"
        jump_user: "root"
        jump_password: "PASSW0RD"
        target_user: "prisma"
        target_password: "PASSW0RD"
      
      k9s:
        available: true
        command: "k9s"
        default_namespace: "panda"
        
      services:
        focus_server:
          name: "panda-panda-focus-server"
          type: "ClusterIP"
          cluster_ip: "10.43.103.101"
          internal_endpoint: "panda-panda-focus-server.panda:5000"
          pod_selector: "app.kubernetes.io/name=panda-panda-focus-server"
        mongodb:
          name: "mongodb"
          type: "LoadBalancer"
          cluster_ip: "10.43.74.248"
          internal_endpoint: "mongodb.panda:27017"
          external_ip: "10.10.100.108:27017"
          pod_selector: "app.kubernetes.io/instance=mongodb"
        rabbitmq:
          name: "rabbitmq-panda"
          type: "LoadBalancer"
          cluster_ip: "10.43.10.166"
          internal_endpoint: "rabbitmq-panda.panda:5672"
          external_ip: "10.10.100.107"
          pod_selector: "app.kubernetes.io/instance=rabbitmq-panda"
        grpc_service:
          name: "grpc-service-*"
          type: "NodePort"
          cluster_ip: "Dynamic (varies per service)"
          internal_endpoint: "grpc-service-*.panda:12301+"
          pod_selector: "app=grpc-service"
          note: "gRPC port starts from 12301 and increments for each service instance"
    
    # SSH Access (Kefar Saba Environment)
    ssh:
      jump_host:
        host: "10.10.100.3"
        port: 22
        username: "root"
        password: "PASSW0RD"
        description: "panda2worker - Proxmox host"
      target_host:
        host: "10.10.100.113"
        port: 22
        username: "prisma"
        password: "PASSW0RD"
        key_file: "~/.ssh/panda_kefar_saba_key"
        description: "worker-node - K8s worker with kubectl/k9s access"
      connect_command: |
        ssh root@10.10.100.3
        # Then from panda2worker:
        ssh prisma@10.10.100.113
        # Then run: k9s
    
    # Test Data
    test_data:
      base_path: "/tmp/focus_kefar_saba_test_data"
      cleanup_after_test: true
    
    # Infrastructure Services
    services:
      focus_server:
        deployment: "panda-panda-focus-server"
        service: "panda-panda-focus-server"
        pod_selector: "app.kubernetes.io/name=panda-panda-focus-server"
      mongodb:
        deployment: "mongodb"
        service: "mongodb"
        pod_selector: "app.kubernetes.io/instance=mongodb"
      rabbitmq:
        deployment: "rabbitmq-panda"
        service: "rabbitmq-panda"
        pod_selector: "app.kubernetes.io/instance=rabbitmq-panda"
    
    # Logging Configuration
    logging:
      log_grpc_messages: false
      log_grpc_validation: false
      log_paging: false
      log_working_queue: false

  # ============================================================================
  # KEFAR_SABA ENVIRONMENT (Alias for Production - IP: 10.10.100.100)
  # ============================================================================
  # This is an alias for the production environment to match workflow defaults
  kefar_saba:
    name: "Kefar Saba"
    description: "Kefar Saba environment (alias for production) with IP address 10.10.100.100"
    
    # Focus Server (Kefar Saba)
    focus_server:
      base_url: "https://10.10.100.100/focus-server/"
      frontend_url: "https://10.10.100.100/liveView"
      frontend_api_url: "https://10.10.100.100/prisma/api/internal/sites/prisma-210-1000"
      site_id: "prisma-210-1000"
      ssl: true
      verify_ssl: false
      
      port_forward:
        enabled: false
        service: "focus-server-service"
        namespace: "default"
        local_port: 5000
        remote_port: 5000
    
    # gRPC Configuration
    grpc:
      timeout_seconds: 500
      stream_min_timeout_seconds: 600
      num_retries: 10
      retry_backoff_factor: 2.0
    
    # System Constraints
    constraints:
      frequency:
        max_hz: 1000
        min_hz: 0
        min_range_hz: 1
      sensors:
        total_range: 2222
        default_start: 11
        default_end: 109
      windows:
        max_concurrent: 30
        num_live_screens: 30
        num_tabs: 10
    
    # NFFT Configuration
    nfft:
      default: 1024
      valid_values:
        - 128
        - 256
        - 512
        - 1024
        - 2048
        - 4096
        - 8192
        - 16384
        - 32768
        - 65536
    
    # Display Defaults
    defaults:
      frequency:
        start_hz: 0
        end_hz: 1000
      waterfall:
        num_lines: 200
      time:
        window_seconds: 30
        display_axis_duration: 30
      view_type: "MultiChannelSpectrogram"
      refresh_rate_hz: 20
    
    # Features
    features:
      enable_reconnection: true
      enable_debug_tools: false
      split_screen: true
      full_screen: false
    
    # Saved Data
    saved_data:
      folder: "C:\\Panda\\SavedData"
      enable_save: true
      enable_load: true
    
    # MongoDB (Kefar Saba/Production LoadBalancer)
    mongodb:
      host: "10.10.100.108"
      port: 27017
      username: "prisma"
      password: "prisma"
      database: "prisma"
      auth_source: "prisma"
      connection_string: "mongodb://prisma:prisma@10.10.100.108:27017/?authSource=prisma"
      ssl: false
      replica_set: null
    
    # RabbitMQ (Kefar Saba/Production LoadBalancer)
    rabbitmq:
      host: "10.10.100.107"
      port: 5672
      ssl_port: 5671
      management_port: 15672
      prometheus_port: 9419
      erlang_port: 4369
      inter_node_port: 25672
      username: "prisma"
      password: "prismapanda"
      vhost: "/"
      ssl: false
      exchange: "prisma"
    
    # Kubernetes (Kefar Saba/Production Cluster)
    kubernetes:
      api_server: "https://10.10.100.102:6443"
      dashboard: "https://10.10.100.102/"
      context: "panda-cluster"
      namespace: "panda"
      config_file: "~/.kube/config-panda"
      
      access_method: "ssh_tunnel"
      ssh_gateway:
        jump_host: "10.10.100.3"
        target_host: "10.10.100.113"
        jump_user: "root"
        jump_password: "PASSW0RD"
        target_user: "prisma"
        target_password: "PASSW0RD"
      
      k9s:
        available: true
        command: "k9s"
        default_namespace: "panda"
        
      services:
        focus_server:
          name: "panda-panda-focus-server"
          type: "ClusterIP"
          cluster_ip: "10.43.103.101"
          internal_endpoint: "panda-panda-focus-server.panda:5000"
          pod_selector: "app.kubernetes.io/name=panda-panda-focus-server"
        mongodb:
          name: "mongodb"
          type: "LoadBalancer"
          cluster_ip: "10.43.74.248"
          internal_endpoint: "mongodb.panda:27017"
          external_ip: "10.10.100.108:27017"
          pod_selector: "app.kubernetes.io/instance=mongodb"
        rabbitmq:
          name: "rabbitmq-panda"
          type: "LoadBalancer"
          cluster_ip: "10.43.10.166"
          internal_endpoint: "rabbitmq-panda.panda:5672"
          external_ip: "10.10.100.107"
          pod_selector: "app.kubernetes.io/instance=rabbitmq-panda"
        grpc_service:
          name: "grpc-service-*"
          type: "NodePort"
          cluster_ip: "Dynamic (varies per service)"
          internal_endpoint: "grpc-service-*.panda:12301+"
          pod_selector: "app=grpc-service"
          note: "gRPC port starts from 12301 and increments for each service instance"
    
    # SSH Access (Kefar Saba/Production Environment)
    ssh:
      jump_host:
        host: "10.10.100.3"
        port: 22
        username: "root"
        password: "PASSW0RD"
        description: "panda2worker - Proxmox host"
      target_host:
        host: "10.10.100.113"
        port: 22
        username: "prisma"
        password: "PASSW0RD"
        key_file: "~/.ssh/panda_kefar_saba_key"
        description: "worker-node - K8s worker with kubectl/k9s access"
      connect_command: |
        ssh root@10.10.100.3
        # Then from panda2worker:
        ssh prisma@10.10.100.113
        # Then run: k9s
    
    # Test Data
    test_data:
      base_path: "/tmp/focus_kefar_saba_test_data"
      cleanup_after_test: true
    
    # Infrastructure Services
    services:
      focus_server:
        deployment: "panda-panda-focus-server"
        service: "panda-panda-focus-server"
        pod_selector: "app.kubernetes.io/name=panda-panda-focus-server"
      mongodb:
        deployment: "mongodb"
        service: "mongodb"
        pod_selector: "app.kubernetes.io/instance=mongodb"
      rabbitmq:
        deployment: "rabbitmq-panda"
        service: "rabbitmq-panda"
        pod_selector: "app.kubernetes.io/instance=rabbitmq-panda"
    
    # Logging Configuration
    logging:
      log_grpc_messages: false
      log_grpc_validation: false
      log_paging: false
      log_working_queue: false

# Default environment
default_environment: "staging"

# Environment-specific test configurations
test_configurations:
  staging:
    # MongoDB Outage Tests - ENABLED IN STAGING
    mongodb_outage:
      enabled: true
      
    # RabbitMQ Outage Tests - ENABLED IN STAGING
    rabbitmq_outage:
      enabled: true
    
    # Performance Tests - ENABLED
    performance:
      enabled: true
      max_concurrent_requests: 10
      test_duration_minutes: 5
    
    # Load Tests - ENABLED IN STAGING
    load_testing:
      enabled: true
      max_concurrent_jobs: 200
  
  kefar_saba:
    # MongoDB Outage Tests - DISABLED
    mongodb_outage:
      enabled: false
      
    # RabbitMQ Outage Tests - DISABLED
    rabbitmq_outage:
      enabled: false
    
    # Performance Tests - ENABLED (safe, read-only)
    performance:
      enabled: true
      max_concurrent_requests: 5
      test_duration_minutes: 2
    
    # Load Tests - DISABLED
    load_testing:
      enabled: false  # Never run load tests in production
      max_concurrent_jobs: 0  # Load tests disabled
  
  kefar_saba:
    # Kefar Saba shares same configuration as production
    mongodb_outage:
      enabled: false
    rabbitmq_outage:
      enabled: false
    performance:
      enabled: true
      max_concurrent_requests: 5
      test_duration_minutes: 2
    load_testing:
      enabled: true  # Allow load testing in kefar_saba
      max_concurrent_jobs: 50


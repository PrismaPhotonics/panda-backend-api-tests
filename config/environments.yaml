# Focus Server Automation Framework - Environment Configuration
# =============================================================
# 
# Environments: staging, local, production, kefar_saba
# Default: staging (November 2025)
# 
# Staging environment uses 10.10.10.100 (new IP addresses)
# Production/Kefar_Saba environment uses 10.10.100.100 (legacy IP addresses)

environments:
  # ============================================================================
  # LOCAL ENVIRONMENT (For Local Development)
  # ============================================================================
  local:
    name: "Local Development"
    description: "Local development environment"
    
    focus_server:
      base_url: "http://localhost:5000"
      ssl: false
      verify_ssl: false
    
    mongodb:
      host: "localhost"
      port: 27017
      username: "admin"
      password: "admin"
      database: "test"
    
    rabbitmq:
      host: "localhost"
      port: 5672
      username: "guest"
      password: "guest"
    
    kubernetes:
      namespace: "default"

  # ============================================================================
  # STAGING ENVIRONMENT (November 2025)
  # ============================================================================
  staging:
    name: "Staging Environment"
    description: "Staging environment for testing with updated IP addresses (10.10.10.100)"
    
    # Focus Server (Staging)
    focus_server:
      base_url: "https://10.10.10.100/focus-server/"  # Backend URL
      frontend_url: "https://10.10.10.100/liveView"    # Frontend URL
      frontend_api_url: "https://10.10.10.100/prisma/api/internal/sites/prisma-210-1000"  # Frontend API URL
      site_id: "prisma-210-1000"
      ssl: true
      verify_ssl: false  # Self-signed cert
      
      # Port forwarding (if needed for local access)
      port_forward:
        enabled: false
        service: "focus-server-service"
        namespace: "default"
        local_port: 5000
        remote_port: 5000
    
    # gRPC Configuration (From usersettings.json)
    grpc:
      timeout_seconds: 500              # GrpcTimeout
      stream_min_timeout_seconds: 600   # GrpcStreamMinTimeout_sec
      num_retries: 10                   # NumGrpcRetries
      retry_backoff_factor: 2.0         # Exponential backoff
    
    # System Constraints (From usersettings.json)
    constraints:
      frequency:
        max_hz: 1000                    # FrequencyMax
        min_hz: 0                       # FrequencyMin
        min_range_hz: 1                 # FrequencyMinRange
      sensors:
        total_range: 2222               # SensorsRange (0-2222)
        default_start: 11               # StartChannel
        default_end: 109                # EndChannel
      windows:
        max_concurrent: 30              # MaxWindows
        num_live_screens: 30            # NumLiveScreens
        num_tabs: 10                    # NumTabs
    
    # NFFT Configuration (From usersettings.json)
    nfft:
      default: 1024                     # Default Nfft
      valid_values:                     # nfftSingleChannel options
        - 128
        - 256
        - 512
        - 1024
        - 2048
        - 4096
        - 8192
        - 16384
        - 32768
        - 65536
    
    # Display Defaults (From usersettings.json)
    defaults:
      frequency:
        start_hz: 0                     # StartFrequency_hz
        end_hz: 1000                    # EndFrequency_hz
      waterfall:
        num_lines: 200                  # NumLinesToDisplay
      time:
        window_seconds: 30              # TimeWindow "30s"
        display_axis_duration: 30       # DisplayTimeAxisDuration
      view_type: "MultiChannelSpectrogram"  # ViewType
      refresh_rate_hz: 20               # RefreshRate
    
    # Features (From usersettings.json)
    features:
      enable_reconnection: true         # EnableReconnection
      enable_debug_tools: false         # EnableDebugTools
      split_screen: true                # SplitScreen
      full_screen: false                # FullScreen
    
    # Saved Data (From usersettings.json)
    saved_data:
      folder: "C:\\Panda\\SavedData"    # SavedData.Folder
      enable_save: true                 # EnableSave
      enable_load: true                 # EnableLoad
    
    # MongoDB (Staging Environment - Different IP from production)
    mongodb:
      host: "10.10.10.108"                # Staging LoadBalancer IP (NOT same as production!)
      port: 27017
      username: "prisma"
      password: "prisma"
      database: "prisma"
      auth_source: "prisma"
      connection_string: "mongodb://prisma:prisma@10.10.10.108:27017/?authSource=prisma"
      ssl: false
      replica_set: null
    
    # RabbitMQ (Staging Environment - Different IP from production)
    rabbitmq:
      host: "10.10.10.107"               # Staging LoadBalancer IP (NOT same as production!)
      port: 5672                         # AMQP
      ssl_port: 5671                     # AMQP SSL
      management_port: 15672             # Management UI
      prometheus_port: 9419              # Prometheus metrics
      erlang_port: 4369                  # Erlang Port Mapper
      inter_node_port: 25672             # Inter-node communication
      username: "prisma"
      password: "prismapanda"
      vhost: "/"
      ssl: false
      exchange: "prisma"
    
    # Kubernetes (Same as production)
    kubernetes:
      api_server: "https://10.10.100.102:6443"
      dashboard: "https://10.10.100.102/"
      context: "panda-cluster"
      namespace: "panda"
      config_file: "~/.kube/config-panda"
      
      access_method: "ssh_tunnel"
      ssh_gateway:
        jump_host: "10.10.10.10"
        target_host: "10.10.10.150"
        jump_user: "root"
        jump_password: "PASSW0RD"
        target_user: "prisma"
        target_password: "PASSW0RD"
      
      k9s:
        available: true
        command: "k9s"
        default_namespace: "panda"
        
      services:
        focus_server:
          name: "panda-panda-focus-server"
          type: "ClusterIP"
          cluster_ip: "10.43.103.101"
          internal_endpoint: "panda-panda-focus-server.panda:5000"
          pod_selector: "app.kubernetes.io/name=panda-panda-focus-server"
        mongodb:
          name: "mongodb"
          type: "LoadBalancer"
          cluster_ip: "10.43.74.248"
          internal_endpoint: "mongodb.panda:27017"
          external_ip: "10.10.10.108:27017"  # Staging LoadBalancer IP
          pod_selector: "app.kubernetes.io/instance=mongodb"
        rabbitmq:
          name: "rabbitmq-panda"
          type: "LoadBalancer"
          cluster_ip: "10.43.10.166"
          internal_endpoint: "rabbitmq-panda.panda:5672"
          external_ip: "10.10.10.107"    # Staging LoadBalancer IP
          pod_selector: "app.kubernetes.io/instance=rabbitmq-panda"
        grpc_service:
          name: "grpc-service-*"
          type: "NodePort"
          cluster_ip: "Dynamic (varies per service)"
          internal_endpoint: "grpc-service-*.panda:12301+"
          pod_selector: "app=grpc-service"
          note: "gRPC port starts from 12301 and increments for each service instance"
    
    # SSH Access (Staging Environment)
    ssh:
      jump_host:
        host: "10.10.10.10"
        port: 22
        username: "root"
        password: "PASSW0RD"
        description: "panda-staging-host - Proxmox staging host"
      target_host:
        host: "10.10.10.150"
        port: 22
        username: "prisma"
        password: "PASSW0RD"  # Not used - key authentication required
        key_file: "~/.ssh/panda_staging_key"  # SSH key for target host
        description: "worker-node - K8s worker with kubectl/k9s access"
      # SSH command to connect
      connect_command: |
        ssh root@10.10.10.10
        # Then from panda-staging-host:
        ssh prisma@10.10.10.150
        # Then run: k9s
    
    # Test Data
    test_data:
      base_path: "/tmp/focus_production_v2_test_data"
      cleanup_after_test: true
    
    # Infrastructure Services
    services:
      focus_server:
        deployment: "panda-panda-focus-server"
        service: "panda-panda-focus-server"
        pod_selector: "app.kubernetes.io/name=panda-panda-focus-server"
      mongodb:
        deployment: "mongodb"
        service: "mongodb"
        pod_selector: "app.kubernetes.io/instance=mongodb"
      rabbitmq:
        deployment: "rabbitmq-panda"
        service: "rabbitmq-panda"
        pod_selector: "app.kubernetes.io/instance=rabbitmq-panda"
    
    # Logging Configuration (From usersettings.json)
    logging:
      log_grpc_messages: false          # Logger.LogGrpcMessages
      log_grpc_validation: false        # Logger.LogGrpcValidation
      log_paging: false                 # Logger.LogPaging
      log_working_queue: false          # Logger.LogWorkingQueue

  # ============================================================================
  # PRODUCTION / KEFAR_SABA ENVIRONMENT (Production IP: 10.10.100.100)
  # ============================================================================
  # Note: 'kefar_saba' is an alias for 'production' - both use the same config
  production: &production_config
    name: "Production (Kefar Saba)"
    description: "Production environment (Kefar Saba) with IP address 10.10.100.100"
    
    # Focus Server (Production)
    focus_server:
      base_url: "https://10.10.100.100/focus-server/"  # Production Backend URL
      frontend_url: "https://10.10.100.100/liveView"    # Production Frontend URL
      frontend_api_url: "https://10.10.100.100/prisma/api/internal/sites/prisma-210-1000"  # Production API URL
      site_id: "prisma-210-1000"
      ssl: true
      verify_ssl: false  # Self-signed cert
      
      # Port forwarding (if needed for local access)
      port_forward:
        enabled: false
        service: "focus-server-service"
        namespace: "default"
        local_port: 5000
        remote_port: 5000
    
    # gRPC Configuration (From usersettings.json)
    grpc:
      timeout_seconds: 500              # GrpcTimeout
      stream_min_timeout_seconds: 600   # GrpcStreamMinTimeout_sec
      num_retries: 10                   # NumGrpcRetries
      retry_backoff_factor: 2.0         # Exponential backoff
    
    # System Constraints (From usersettings.json)
    constraints:
      frequency:
        max_hz: 1000                    # FrequencyMax
        min_hz: 0                       # FrequencyMin
        min_range_hz: 1                 # FrequencyMinRange
      sensors:
        total_range: 2222               # SensorsRange (0-2222)
        default_start: 11               # StartChannel
        default_end: 109                # EndChannel
      windows:
        max_concurrent: 30              # MaxWindows
        num_live_screens: 30            # NumLiveScreens
        num_tabs: 10                    # NumTabs
    
    # NFFT Configuration (From usersettings.json)
    nfft:
      default: 1024                     # Default Nfft
      valid_values:                     # nfftSingleChannel options
        - 128
        - 256
        - 512
        - 1024
        - 2048
        - 4096
        - 8192
        - 16384
        - 32768
        - 65536
    
    # Display Defaults (From usersettings.json)
    defaults:
      frequency:
        start_hz: 0                     # StartFrequency_hz
        end_hz: 1000                    # EndFrequency_hz
      waterfall:
        num_lines: 200                  # NumLinesToDisplay
      time:
        window_seconds: 30              # TimeWindow "30s"
        display_axis_duration: 30       # DisplayTimeAxisDuration
      view_type: "MultiChannelSpectrogram"  # ViewType
      refresh_rate_hz: 20               # RefreshRate
    
    # Features (From usersettings.json)
    features:
      enable_reconnection: true         # EnableReconnection
      enable_debug_tools: false         # EnableDebugTools
      split_screen: true                # SplitScreen
      full_screen: false                # FullScreen
    
    # Saved Data (From usersettings.json)
    saved_data:
      folder: "C:\\Panda\\SavedData"    # SavedData.Folder
      enable_save: true                 # EnableSave
      enable_load: true                 # EnableLoad
    
    # MongoDB (Production LoadBalancer)
    mongodb:
      host: "10.10.100.108"              # External LoadBalancer IP
      port: 27017
      username: "prisma"
      password: "prisma"
      database: "prisma"
      auth_source: "prisma"
      connection_string: "mongodb://prisma:prisma@10.10.100.108:27017/?authSource=prisma"
      ssl: false
      replica_set: null
    
    # RabbitMQ (Production LoadBalancer)
    rabbitmq:
      host: "10.10.100.107"              # External LoadBalancer IP
      port: 5672                         # AMQP
      ssl_port: 5671                     # AMQP SSL
      management_port: 15672             # Management UI
      prometheus_port: 9419              # Prometheus metrics
      erlang_port: 4369                  # Erlang Port Mapper
      inter_node_port: 25672             # Inter-node communication
      username: "prisma"
      password: "prismapanda"
      vhost: "/"
      ssl: false
      exchange: "prisma"
    
    # Kubernetes (Production Cluster)
    kubernetes:
      api_server: "https://10.10.100.102:6443"
      dashboard: "https://10.10.100.102/"
      context: "panda-cluster"
      namespace: "panda"
      config_file: "~/.kube/config-panda"
      
      access_method: "ssh_tunnel"
      ssh_gateway:
        jump_host: "10.10.100.3"         # Production jump host
        target_host: "10.10.100.113"     # Production worker node
        jump_user: "root"
        jump_password: "PASSW0RD"
        target_user: "prisma"
        target_password: "PASSW0RD"
      
      k9s:
        available: true
        command: "k9s"
        default_namespace: "panda"
        
      services:
        focus_server:
          name: "panda-panda-focus-server"
          type: "ClusterIP"
          cluster_ip: "10.43.103.101"
          internal_endpoint: "panda-panda-focus-server.panda:5000"
          pod_selector: "app.kubernetes.io/name=panda-panda-focus-server"
        mongodb:
          name: "mongodb"
          type: "LoadBalancer"
          cluster_ip: "10.43.74.248"
          internal_endpoint: "mongodb.panda:27017"
          external_ip: "10.10.100.108:27017"
          pod_selector: "app.kubernetes.io/instance=mongodb"
        rabbitmq:
          name: "rabbitmq-panda"
          type: "LoadBalancer"
          cluster_ip: "10.43.10.166"
          internal_endpoint: "rabbitmq-panda.panda:5672"
          external_ip: "10.10.100.107"
          pod_selector: "app.kubernetes.io/instance=rabbitmq-panda"
        grpc_service:
          name: "grpc-service-*"
          type: "NodePort"
          cluster_ip: "Dynamic (varies per service)"
          internal_endpoint: "grpc-service-*.panda:12301+"
          pod_selector: "app=grpc-service"
          note: "gRPC port starts from 12301 and increments for each service instance"
    
    # SSH Access (Production Environment)
    ssh:
      jump_host:
        host: "10.10.100.3"
        port: 22
        username: "root"
        password: "PASSW0RD"
        description: "panda2worker - Proxmox production host"
      target_host:
        host: "10.10.100.113"
        port: 22
        username: "prisma"
        password: "PASSW0RD"  # Not used - key authentication required
        key_file: "~/.ssh/panda_production_key"  # SSH key for target host
        description: "worker-node - K8s worker with kubectl/k9s access"
      # SSH command to connect
      connect_command: |
        ssh root@10.10.100.3
        # Then from panda2worker:
        ssh prisma@10.10.100.113
        # Then run: k9s
    
    # Test Data
    test_data:
      base_path: "/tmp/focus_production_test_data"
      cleanup_after_test: true
    
    # Infrastructure Services
    services:
      focus_server:
        deployment: "panda-panda-focus-server"
        service: "panda-panda-focus-server"
        pod_selector: "app.kubernetes.io/name=panda-panda-focus-server"
      mongodb:
        deployment: "mongodb"
        service: "mongodb"
        pod_selector: "app.kubernetes.io/instance=mongodb"
      rabbitmq:
        deployment: "rabbitmq-panda"
        service: "rabbitmq-panda"
        pod_selector: "app.kubernetes.io/instance=rabbitmq-panda"
    
    # Logging Configuration (From usersettings.json)
    logging:
      log_grpc_messages: false          # Logger.LogGrpcMessages
      log_grpc_validation: false        # Logger.LogGrpcValidation
      log_paging: false                 # Logger.LogPaging
      log_working_queue: false          # Logger.LogWorkingQueue

  # ============================================================================
  # KEFAR_SABA ENVIRONMENT (Alias for Production)
  # ============================================================================
  # This is an alias for the production environment, matching the GitHub
  # Environment name 'kefar_saba' used in GitHub Actions workflows
  kefar_saba: *production_config

# Default environment
default_environment: "staging"  # UPDATED to new environment

# Environment aliases (for reference)
environment_aliases:
  kefar_saba: production  # kefar_saba is an alias for production

# Environment-specific test configurations
test_configurations:
  staging:
    # MongoDB Outage Tests - ENABLED IN STAGING
    mongodb_outage:
      enabled: true  # Safe to test in staging
      
    # RabbitMQ Outage Tests - ENABLED IN STAGING
    rabbitmq_outage:
      enabled: true  # Safe to test in staging
    
    # Performance Tests - ENABLED
    performance:
      enabled: true
      max_concurrent_requests: 10
      test_duration_minutes: 5
    
    # Load Tests - ENABLED IN STAGING
    load_testing:
      enabled: true  # Full load testing in staging
      max_concurrent_jobs: 200  # Full capacity testing
  
  production:
    # MongoDB Outage Tests - DISABLED IN PRODUCTION
    mongodb_outage:
      enabled: false  # Do not run destructive tests in production
      
    # RabbitMQ Outage Tests - DISABLED IN PRODUCTION
    rabbitmq_outage:
      enabled: false  # Do not run destructive tests in production
    
    # Performance Tests - ENABLED (safe, read-only)
    performance:
      enabled: true
      max_concurrent_requests: 5
      test_duration_minutes: 2
    
    # Load Tests - DISABLED IN PRODUCTION
    load_testing:
      enabled: false  # Never run load tests in production
      max_concurrent_jobs: 0  # Load tests disabled
  
  # kefar_saba uses same test config as production
  kefar_saba:
    mongodb_outage:
      enabled: false
    rabbitmq_outage:
      enabled: false
    performance:
      enabled: true
      max_concurrent_requests: 5
      test_duration_minutes: 2
    load_testing:
      enabled: false
      max_concurrent_jobs: 0
